name: ğŸ”„ Update Xray Subscription

on:
  workflow_dispatch:
    inputs:
      sub_links:
        description: 'Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¨Ø³Ú©Ø±ÛŒÙ¾Ø´Ù† V2Ray/Xray (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)'
        required: true
        default: 'https://pooriared.faridiosak.workers.dev/...' # Ù†Ù…ÙˆÙ†Ù‡ Ù„ÛŒÙ†Ú©

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: ğŸ› ï¸ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: ğŸƒ Run Aggregator Script
      env:
        SUB_LINKS: ${{ github.event.inputs.sub_links }} # Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ø¨Ù‡ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
      run: python aggregator.py

    - name: ğŸ“¤ Commit and Push new config
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "Auto update Xray Base64 config"
        files: POORIARED_sub.txt # ğŸ‘ˆ Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ Ø¬Ø¯ÛŒØ¯
