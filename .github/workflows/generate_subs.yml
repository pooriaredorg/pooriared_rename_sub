name: Generate Subscriptions

on:
  workflow_dispatch:
    inputs:
      base_name_suffix:
        description: 'نامی که می‌خواهید به انتهای نام ساب‌ها و فایل‌ها اضافه شود (مثلاً ALI)'
        required: true
        default: 'suffix'
        type: string
      config_index: 
        description: 'شماره کانفیگی که می‌خواهید به ساب تبدیل شود (مثلاً 1 برای کانفیگ اول)'
        required: true
        default: '1'
        type: string 

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    # گام مهم برای رفع خطای MODULE_NOT_FOUND (مجوز اجرا)
    - name: Give execute permission to script
      run: chmod +x .github/workflows/generate.js

    - name: Run Subscriptions Generator Script
      id: generate
      run: node .github/workflows/generate.js
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        CONFIG_URL: "https://raw.githubusercontent.com/pooriaredorg/pooriaredorg/refs/heads/main/configs/proxy_configs.txt"
        
        CONFIG_NAME_SUFFIX: ${{ github.event.inputs.base_name_suffix }} 
        CONFIG_INDEX: ${{ github.event.inputs.config_index }}
