name: Generate Subscriptions

on:
  workflow_dispatch:
    inputs:
      base_name_suffix:
        description: 'Ù†Ø§Ù…ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø§Ù†ØªÙ‡Ø§ÛŒ Ù†Ø§Ù… Ø³Ø§Ø¨â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ ALI)'
        required: true
        default: 'suffix'
        type: string
      config_index: 
        description: 'Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø³Ø§Ø¨ ØªØ¨Ø¯ÛŒÙ„ Ø´ÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1 Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯ Ø§ÙˆÙ„)'
        required: true
        default: '1'
        type: string 

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    # ğŸŒŸ Ú¯Ø§Ù… Ø¬Ø¯ÛŒØ¯: Ø§ÛŒØ¬Ø§Ø¯ package.json Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ESM Ùˆ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
    - name: Setup ESM and Install Dependencies
      run: |
        echo '{"type": "module"}' > .github/workflows/package.json
        npm install @octokit/rest node-fetch --prefix .github/workflows
        
    - name: Give execute permission to script
      run: chmod +x .github/workflows/generate.js

    - name: Run Subscriptions Generator Script
      id: generate
      # ğŸŒŸ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… ÙØ§ÛŒÙ„
      run: node $GITHUB_WORKSPACE/.github/workflows/generate.js 
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        CONFIG_URL: "https://raw.githubusercontent.com/pooriaredorg/pooriaredorg/refs/heads/main/configs/proxy_configs.txt"
        
        CONFIG_NAME_SUFFIX: ${{ github.event.inputs.base_name_suffix }} 
        CONFIG_INDEX: ${{ github.event.inputs.config_index }}
