name: Generate Subscriptions

on:
  workflow_dispatch:
    inputs:
      base_name_suffix:
        description: 'Ù†Ø§Ù…ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø§Ù†ØªÙ‡Ø§ÛŒ Ù†Ø§Ù… Ø³Ø§Ø¨â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ ALI)'
        required: true
        default: 'suffix'
        type: string
      config_index: 
        description: 'Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø³Ø§Ø¨ ØªØ¨Ø¯ÛŒÙ„ Ø´ÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ 1 Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯ Ø§ÙˆÙ„)'
        required: true
        default: '1'
        type: string 

# ğŸŒŸ Ù…Ù‡Ù…: Ø§Ø¹Ø·Ø§ÛŒ Ù…Ø¬ÙˆØ² Ù†ÙˆØ´ØªÙ† Ø¨Ø±Ø§ÛŒ Commit Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„
permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Run Subscriptions Generator Script (Generate Local File)
      run: node .github/workflows/generate.js
      env:
        # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø§Ú˜ÙˆÙ„ https Ø¯Ø§Ø®Ù„ÛŒ Node.js
        CONFIG_URL: "https://raw.githubusercontent.com/pooriaredorg/pooriaredorg/refs/heads/main/configs/proxy_configs.txt"
        CONFIG_NAME_SUFFIX: ${{ github.event.inputs.base_name_suffix }} 
        CONFIG_INDEX: ${{ github.event.inputs.config_index }}

    # ğŸŒŸ Ú¯Ø§Ù… Ù†Ù‡Ø§ÛŒÛŒ: Commit Ùˆ Push Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ (Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Octokit)
    - name: Commit and Push Changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ¤– Generated subscription: ${{ github.event.inputs.base_name_suffix }}-${{ github.event.inputs.config_index }}"
        file_pattern: output/*.txt
        # Ø§ÛŒÙ† Ø§Ú©Ø´Ù† Ø§Ø² GITHUB_TOKEN Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
